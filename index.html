<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>é«˜çŸ¥çœŒç«‹å¤§å­¦ ç©ºãæ™‚é–“è¦³å…‰ãƒãƒƒãƒ—</title>

<!-- Leaflet -->
<link
rel="stylesheet"
href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
body {
margin: 0;
font-family: sans-serif;
}
h1 {
text-align: center;
margin: 10px 0;
}
.buttons {
text-align: center;
margin-bottom: 8px;
}
button {
padding: 6px 10px;
margin: 4px;
cursor: pointer;
border-radius: 6px;
}
#map {
height: 85vh;
}
</style>
</head>

<body>
<h1>ğŸ“â˜• é«˜çŸ¥çœŒç«‹å¤§å­¦ ç©ºãæ™‚é–“è¦³å…‰ãƒãƒƒãƒ—</h1>

<div class="buttons">
<button onclick="showAll()">ã™ã¹ã¦</button>
<button onclick="filterTime('1')">1æ™‚é–“ä»¥å†…</button>
<button onclick="filterTime('2')">2æ™‚é–“ä»¥ä¸Š</button>
<button onclick="filterRain()">â˜” é›¨ã®æ—¥OK</button>
<button onclick="filterCafe()">â˜• ã‚«ãƒ•ã‚§ã®ã¿</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ===== èµ·ç‚¹ï¼šé«˜çŸ¥çœŒç«‹å¤§å­¦ï¼ˆæ°¸å›½å¯ºã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ï¼‰ ===== */
const university = [33.5567, 133.5406];

const map = L.map("map").setView(university, 14);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
attribution: "Â© OpenStreetMap contributors"
}).addTo(map);

/* ===== å¤§å­¦ã ã‘è‰²ä»˜ããƒ”ãƒ³ï¼ˆé’ï¼‰ ===== */
const universityIcon = new L.Icon({
iconUrl: "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png",
shadowUrl: "https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",
iconSize: [25, 41],
iconAnchor: [12, 41],
popupAnchor: [1, -34],
shadowSize: [41, 41]
});

L.marker(university, { icon: universityIcon })
.addTo(map)
.bindPopup("ğŸ“ é«˜çŸ¥çœŒç«‹å¤§å­¦ï¼ˆæ°¸å›½å¯ºã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ï¼‰")
.openPopup();

/* ===== è¦³å…‰åœ°ãƒ»ã‚«ãƒ•ã‚§ãƒ‡ãƒ¼ã‚¿ ===== */
const spots = [
// è¦³å…‰åœ°
{ name: "ã²ã‚ã‚å¸‚å ´", lat: 33.5606, lng: 133.5310, time: "1", rain: true, type: "è¦³å…‰" },
{ name: "é«˜çŸ¥åŸ", lat: 33.5590, lng: 133.5332, time: "1", rain: false, type: "è¦³å…‰" },
{ name: "é«˜çŸ¥åŸæ­´å²åšç‰©é¤¨", lat: 33.5602, lng: 133.5343, time: "1", rain: true, type: "è¦³å…‰" },
{ name: "ç‰§é‡æ¤ç‰©åœ’", lat: 33.5686, lng: 133.5517, time: "2", rain: false, type: "è¦³å…‰" },
{ name: "æ¡‚æµœ", lat: 33.4968, lng: 133.5713, time: "2", rain: false, type: "è‡ªç„¶" },

// ã‚«ãƒ•ã‚§
{ name: "åœŸä½èŒ¶ã‚«ãƒ•ã‚§", lat: 33.5618, lng: 133.5305, time: "1", rain: true, type: "ã‚«ãƒ•ã‚§" },
{ name: "åœŸä½èŒ¶ã‚«ãƒ•ã‚§ æ°¸å›½å¯º", lat: 33.5581, lng: 133.5418, time: "1", rain: true, type: "ã‚«ãƒ•ã‚§" },
{ name: "ã‚³ãƒ¼ãƒ’ãƒ¼ãƒã‚¦ã‚¹ã¾ã‚‹ã‚‚", lat: 33.5598, lng: 133.5298, time: "1", rain: true, type: "ã‚«ãƒ•ã‚§" },
{ name: "ã‚«ãƒ•ã‚§ãƒ»ãƒ‰ãƒ»ãƒ©ãƒš", lat: 33.5574, lng: 133.5339, time: "1", rain: true, type: "ã‚«ãƒ•ã‚§" }
];

let markers = [];

function clearMarkers() {
markers.forEach(m => map.removeLayer(m));
markers = [];
}

/* ===== å¾’æ­©æ™‚é–“è¨ˆç®— ===== */
function walkTime(lat, lng) {
const R = 6371;
const dLat = (lat - university[0]) * Math.PI / 180;
const dLng = (lng - university[1]) * Math.PI / 180;
const a =
Math.sin(dLat/2) ** 2 +
Math.cos(university[0] * Math.PI / 180) *
Math.cos(lat * Math.PI / 180) *
Math.sin(dLng/2) ** 2;
const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
const distance = R * c;
return Math.round(distance / 0.08); // å¾’æ­©80m/åˆ†
}

function showSpots(filterFn = null) {
clearMarkers();

spots.forEach(spot => {
if (filterFn && !filterFn(spot)) return;

const walk = walkTime(spot.lat, spot.lng);

const marker = L.marker([spot.lat, spot.lng])
.addTo(map)
.bindPopup(`
<b>${spot.name}</b><br>
ğŸ· ${spot.type}<br>
â° ${spot.time === "1" ? "1ã€œ2æ™‚é–“" : "2æ™‚é–“ä»¥ä¸Š"}<br>
ğŸš¶ å¾’æ­© ç´„${walk}åˆ†<br>
â˜” ${spot.rain ? "é›¨OK" : "é›¨NG"}
`);

markers.push(marker);
});
}

function showAll() {
showSpots();
}
function filterTime(time) {
showSpots(s => s.time === time);
}
function filterRain() {
showSpots(s => s.rain);
}
function filterCafe() {
showSpots(s => s.type === "ã‚«ãƒ•ã‚§");
}

showAll();
</script>
</body>
</html>
